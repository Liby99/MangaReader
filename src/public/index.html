<!DOCTYPE html>
<html>
    <head>
        <%- include("view/header.html") %>
        <title>SaeManga - Home</title>
        <link rel="stylesheet" href="css/index.css" />
    </head>
    <body>
        
        <!-- Sidebar Nav -->
        <%- include("view/sidebar.html", { loggedIn: loggedIn, user: user }) %>
        
        <!-- Main Page -->
        <main>
            <section id="index-header-section" style="padding: 60px 0 30px">
                <center>
                    <h1>冴え漫画 の 書架</h1>
                    <p style="margin-top: 0px;">
                        <span>
                            <% if (loggedIn) { %>
                                <span>欢迎回来，</span>
                                <a href="#"><%= user.username %></a>
                            <% } else { %>
                                <span>欢迎光临，</span>
                                <a href="#" onclick="User.showLogin()">点此登陆</a>
                            <% } %>
                        </span>
                    </p>
                </center>
            </section>
            <section id="index-search-section">
                <div id="index-search-form-outer" class="wrapper">
                    <form id="index-search-form">
                        <i class="fa fa-search"></i>
                        <input type="text" name="search" id="index-search" placeholder="请在这里输入想要搜索的漫画" autocomplete="off" />
                        <div>
                            <img id="index-search-loading" src="img/loading.svg" hidden="hidden" />
                            <a id="index-search-clear" class="btn circle grey solid" href="#" hidden="hidden" onclick="Search.clear()">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </form>
                </div>
                <div id="index-search-result-outer" class="scroll x wrapper" style="padding-top: 0" hidden="hidden">
                    <div id="index-search-result" class="flex">
                        <!-- Template search-manga -->
                    </div>
                </div>
            </section>
            <section id="index-discover-section">
                <div class="flex full wrapper">
                    <h3>发现</h3>
                    <div class="flex-fill flex right">
                        <a href="#" id="index-discover-tags-toggle" class="fa-rotation-toggle">
                            <i class="fa fa-bars"></i>
                            <i class="fa fa-angle-right"></i>
                        </a>
                        <div id="index-discover-tags-holder" class="scroll x flex right hide-scrollbar">
                            <div id="index-discover-tags" class="flex">
                                <% genres.forEach(function (genre, i) { %>
                                    <a class="btn rounded tag" id="<%= genre.dir %>" href="#"><%= genre.name %></a>
                                <% }) %>
                            </div>
                        </div>
                        <!-- <a id="feeling-lucky" class="nowrap btn rounded full" href="#">手气不错</a> -->
                    </div>
                </div>
                <div id="index-discover-outer" class="scroll x wrapper" style="padding-top: 0">
                    <div id="index-discover-content" class="flex">
                        <% latests.forEach(function (manga, i) { %>
                            <a class="manga discover" href="/manga.html?id=<%= manga.dmk_id %>" id="<%= manga._id %>">
                                <div class="cover" style="background-image: url('http://img.cartoonmad.com/ctimg/<%= manga.dmk_id %>.jpg')"></div>
                                <h4 class="title"><%= manga.info.title %></h4>
                            </a>
                        <% }) %>
                    </div>
                </div>
            </section>
            <section id="index-following-section">
                <div id="index-following-header" class="stick-top">
                    <div class="placeholder"></div>
                    <div class="content" id="index-following-header-content">
                        <div id="index-following-header-inner" class="flex wrapper">
                            <h3>正在追的</h3>
                            <% if (loggedIn) { %>
                                <div id="index-following-menu" class="flex-fill flex right">
                                    <a id="index-following-manage" href="#" class="btn rounded" style="padding-right: 5px">
                                        <span>管理</span>
                                        <i class="fa-rotation-toggle">
                                            <i class="fa fa-pencil"></i>
                                            <i class="fa fa-check"></i>
                                        </i>
                                    </a>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
                <div id="index-following-list" class="flex wrap wrapper" style="padding-top: 0">
                    <% if (loggedIn) { %>
                        <% if (follows.length) { %>
                            <% follows.forEach(function (follow, i) { %>
                                <a class="mix manga following" id="<%= follow.manga._id %>" href="/manga.html?id=<%= follow.manga.dmk_id %>">
                                    <div class="cover" style="background-image: url('http://img.cartoonmad.com/ctimg/<%= follow.manga.dmk_id %>.jpg')">
                                        <span class="badge <%= follow.hasUpdate ? '' : 'hidden' %>"></span>
                                        <span class="remove btn circle grey solid">
                                            <i class="fa fa-times"></i>
                                        </span>
                                    </div>
                                    <center>
                                        <p class="episode">
                                            已读<%= follow.max_episode %>话，
                                            <% if (follow.manga.info.ended) { %>
                                                共<%= follow.manga.lastEpisode %>话，已完结
                                            <% } else if (follow.hasUpdate) { %>
                                                更新至<%= follow.manga.lastEpisode %>话
                                            <% } else { %>
                                                未更新
                                            <% } %>
                                        </p>
                                        <h4 class="title"><%= follow.manga.info.title %></h4>
                                    </center>
                                </a>
                            <% }) %>
                        <% } else { %>
                            <div class="flex-fill wrapper">
                                <center>
                                    <p>
                                        您还没有关注任何漫画呢！
                                    </p>
                                </center>
                            </div>
                        <% } %>
                    <% } else { %>
                        <div class="flex-fill wrapper">
                            <center>
                                <p>
                                    请登陆已有账户或注册一个新账户以开启储存您正在关注的漫画的功能
                                </p>
                                <p>
                                    <a class="btn solid rounded big" href="#" onclick="User.showLogin()">登录已有账户</a>
                                    <span style="margin: 0 5px">或</span>
                                    <a class="btn rounded big" href="#" onclick="User.showRegister()">注册新账户</a>
                                </p>
                            </center>
                        </div>
                    <% } %>
                </div>
            </section>
            <%- include("view/footer.html") %>
        </main>
        
        <!-- Panels -->
        <%- include("view/panels/about.html") %>
        <%- include("view/panels/help.html") %>
        <%- include("view/panels/register.html") %>
        <%- include("view/panels/change_password.html") %>
        
        <!-- templates -->
        <%- include("view/templates/discover_manga.html") %>
        <%- include("view/templates/search_manga.html") %>
        <%- include("view/templates/not_following_manga.html") %>
        
        <!-- Library load after page -->
        <script src="js/lib/panel.js"></script>
        
        <!-- Scripts load after page -->
        <script src="js/index.js"></script>
        <script src="js/sidebar.js"></script>
        <script src="js/user.js"></script>
        <script src="js/search.js"></script>
        <script src="js/discover.js"></script>
        <script src="js/follow.js"></script>
    </body>
</html>
