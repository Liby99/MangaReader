(function ($) {

    function down($toggle, $list) {
        $toggle.addClass("on");
        $list.slideDown(200);
        var $input = $("<input style='position: absolute; opacity: 0; top: -10000px; left: -10000px' />");
        $input.on("blur", function () {
            up($toggle, $list);
        });
        $input.appendTo($toggle);
        $input.focus();
    }

    function up($toggle, $list) {
        $toggle.removeClass("on");
        $list.slideUp(200);
        $toggle.children("input").remove();
    }

    function toggle($toggle, $list) {
        if ($list.css("display") === "none")
            down($toggle, $list);
        else
            up($toggle, $list);
    }
    
    $.fn.dropdown = function () {
        var $elem = $(this);
        $elem.width($elem.children(".dropdown-wrap").width());
        $elem.find(".dropdown-toggle").click(function () {
            var $toggle = $(this);
            var $list = $($toggle.attr("for"));
            toggle($toggle, $list);
        });
    };
})(jQuery);

<a id="index-following-manage" href="#" class="btn rounded flex" style="padding-right: 5px">
    <span>管理</span>
    <i class="fa-rotation-toggle">
        <i class="fa fa-pencil"></i>
        <i class="fa fa-check" hidden="hidden"></i>
    </i>
</a>

<div class="flex right" style="margin-right: 10px">
    <div id="index-filter-dropdown" class="dropdown">
        <div class="dropdown-wrap">
            <a id="index-filter-dropdown-toggle" href="#" class="btn dropdown-toggle" for="#index-filter-dropdown-list">
                筛选
                <i class="fa fa-filter"></i>
            </a>
            <ul id="index-filter-dropdown-list" class="dropdown-list" hidden="hidden">
                <li>
                    <a href="#" class="index-filter" data-filter="!follow.upToDate()">有更新的</a>
                </li>
                <li>
                    <a href="#" class="index-filter" data-filter="manga.ended()">已完结</a>
                </li>
                <hr />
            </ul>
        </div>
    </div>
</div>


.dropdown {
    padding: 0;
}

.dropdown .dropdown-wrap {
    position: absolute;
}

.dropdown .dropdown-toggle {
    display: block;
    padding: 0 10px;
}

.dropdown .btn.dropdown-toggle {
    transition: all 0.2s;
}

.dropdown .btn.dropdown-toggle.on {
    border-radius: 3px 3px 0 0;
    border-bottom: none;
}

.dropdown .dropdown-list {
    position: sticky;
    list-style: none;
    padding: 0;
    margin: 0;
    max-height: 200px;
    background-color: var(--white);
    border-radius: 0 0 3px 3px;
    border-right: 1px solid var(--pink);
    border-left: 1px solid var(--pink);
    border-bottom: 1px solid var(--pink);
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
}

.dropdown .dropdown-list > hr {
    margin: 1px 0;
}

.dropdown .dropdown-list > li > a {
    display: block;
    font-size: 12px;
    line-height: 20px;
    padding: 0 10px;
    white-space: nowrap;
}

.dropdown .dropdown-list > li > a:hover {
    background-color: var(--pink-10);
}

.dropdown .dropdown-list > li > a:active {
    background-color: var(--pink-20);
}

var Follow = {
    $filter: $("#index-filter-dropdown"),
    initiate: function () {
        this.initiateFilter();
    },
    initiateFilter: function () {
        this.renderGenreFilters(Genre.get());
        this.$filter.dropdown();
    },
    renderGenreFilters: function (gs) {
        $("#index-filter-dropdown-list").render("filter-genre", gs.map((o) => {
            o.id = "filter-" + o.dir;
            return o;
        }));
    }
}
